<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <meta name="description" content="As a course of developing for larger Drupal sites, you typically find yourself having multiple environments, one for development, one or more for staging or user acceptance testing, and another for production (and perhaps disaster recovery).">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- OpenGraph Tags -->
    <meta property="og:title" content="Environment aware Drupal sites" />
    <meta property="og:site_name" content="Pixelite" />
    <meta property="og:url" content="http://www.pixelite.co.nz/article/environment-aware-drupal-sites" />
    <meta property="og:description" content="" />
    <meta property="fb:app_id" content="410615979137383" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    
        <meta property="og:image" content="http://www.pixelite.co.nz/img/post-bg-01.jpg" />
    

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@pixelite_">
    
        <meta name="twitter:creator" content="@wiifm">
    
    <meta name="twitter:title" content="Environment aware Drupal sites">
    <meta name="twitter:description" content="">
    
        <meta name="twitter:image" content="http://www.pixelite.co.nz/img/post-bg-01.jpg">
    


    <title>Environment aware Drupal sites - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/environment-aware-drupal-sites">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    

<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="878"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/environment-aware-drupal-sites"/>

    <!-- Post Header -->
    <header class="intro-header" style="background-image: url('/img/post-bg-01.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 itemprop="name headline">Environment aware Drupal sites</h1>
                        

                        <span class="meta">Posted by <a href="/authors/sean-hamlin/" title="View Sean Hamlin's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span></a> on <time datetime="2014-09-29T00:00:00" itemprop="datePublished">September 29, 2014</time></span>
                        <ul class="social-buttons cf">
                            <li>
                                <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Environment aware Drupal sites" data-url="http://www.pixelite.co.nz/article/environment-aware-drupal-sites" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/environment-aware-drupal-sites" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/environment-aware-drupal-sites" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                            </li>
                            <li>
                                <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/environment-aware-drupal-sites&amp;t=Environment%20aware%20Drupal%20sites" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/environment-aware-drupal-sites" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                            </li>
                            <li>
                                <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/environment-aware-drupal-sites&amp;title=Environment%20aware%20Drupal%20sites" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/environment-aware-drupal-sites" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>As a course of developing for larger Drupal sites, you typically find yourself having multiple environments, one for development, one or more for staging or user acceptance testing, and another for production (and perhaps disaster recovery).</p>

<p>One thing that always comes up is making Drupal “environment” aware, so it knows how it should behave, what modules should be turned on (or off) and what servers it should be talking to for instance.</p>

<h2 id="environment-module">Environment module</h2>

<p>The <a href="https://www.drupal.org/project/environment">environment module</a> allows you to define arbitrary environments (it also comes with some out of the box) in code. Example hook</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * Implements hook_environment().</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">HOOK_config_environment</span><span class="p">()</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 7</span>     <span class="s1">&#39;prod&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 8</span>       <span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Production&#39;</span><span class="p">),</span>
<span class="lineno"> 9</span>       <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Live sites are in full production and browsable on the web.&#39;</span><span class="p">),</span>
<span class="lineno">10</span>       <span class="s1">&#39;allowed&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">11</span>         <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<span class="lineno">12</span>       <span class="p">),</span>
<span class="lineno">13</span>     <span class="p">),</span>
<span class="lineno">14</span>     <span class="s1">&#39;dev&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">15</span>       <span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Development&#39;</span><span class="p">),</span>
<span class="lineno">16</span>       <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Developer machines.&#39;</span><span class="p">),</span>
<span class="lineno">17</span>       <span class="s1">&#39;allowed&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">18</span>         <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">FALSE</span><span class="p">,</span>
<span class="lineno">19</span>       <span class="p">),</span>
<span class="lineno">20</span>     <span class="p">),</span>
<span class="lineno">21</span>     <span class="s1">&#39;staging&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">22</span>       <span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Staging&#39;</span><span class="p">),</span>
<span class="lineno">23</span>       <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Bug fixes and testing are done here.&#39;</span><span class="p">),</span>
<span class="lineno">24</span>       <span class="s1">&#39;allowed&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">25</span>         <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">FALSE</span><span class="p">,</span>
<span class="lineno">26</span>       <span class="p">),</span>
<span class="lineno">27</span>     <span class="p">),</span>
<span class="lineno">28</span>   <span class="p">);</span>
<span class="lineno">29</span> <span class="p">}</span>
<span class="lineno">30</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>You also may want to remove the default environments that come with the environment module</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * Implements hook_environment_alter().</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">HOOK_config_environment_alter</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$environments</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="c1">// Remove default environments.</span>
<span class="lineno"> 7</span>   <span class="nb">unset</span><span class="p">(</span><span class="nv">$environments</span><span class="p">[</span><span class="s1">&#39;production&#39;</span><span class="p">]);</span>
<span class="lineno"> 8</span>   <span class="nb">unset</span><span class="p">(</span><span class="nv">$environments</span><span class="p">[</span><span class="s1">&#39;development&#39;</span><span class="p">]);</span>
<span class="lineno"> 9</span> <span class="p">}</span>
<span class="lineno">10</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>Using this code, and some magic in settings.php, you can effectively tell Drupal which environment it is by switching on the HTTP_HOST. A stripped back example is:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="c1">// Include environment-specific config by parsing the URL.</span>
<span class="lineno"> 3</span> <span class="c1">// To override this, set $environment in settings.php</span>
<span class="lineno"> 4</span> <span class="c1">// BEFORE including this file.</span>
<span class="lineno"> 5</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$environment</span><span class="p">))</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">],</span> <span class="s1">&#39;.demo.net.nz&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 7</span>     <span class="nv">$environment</span> <span class="o">=</span> <span class="s1">&#39;staging&#39;</span><span class="p">;</span>
<span class="lineno"> 8</span>   <span class="p">}</span>
<span class="lineno"> 9</span>   <span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">],</span> <span class="s1">&#39;local&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">10</span>     <span class="nv">$environment</span> <span class="o">=</span> <span class="s1">&#39;dev&#39;</span><span class="p">;</span>
<span class="lineno">11</span>   <span class="p">}</span>
<span class="lineno">12</span>   <span class="k">else</span> <span class="p">{</span>
<span class="lineno">13</span>     <span class="c1">// Default to production.</span>
<span class="lineno">14</span>     <span class="nv">$environment</span> <span class="o">=</span> <span class="s1">&#39;prod&#39;</span><span class="p">;</span>
<span class="lineno">15</span>   <span class="p">}</span>
<span class="lineno">16</span> <span class="p">}</span>
<span class="lineno">17</span> <span class="c1">// The environment module uses a lowercase variable.</span>
<span class="lineno">18</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;environment&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$environment</span><span class="p">;</span>
<span class="lineno">19</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ENVIRONMENT&#39;</span><span class="p">,</span> <span class="nv">$environment</span><span class="p">);</span>
<span class="lineno">20</span> 
<span class="lineno">21</span> <span class="c1">// Load the environment config file, followed by host-specific</span>
<span class="lineno">22</span> <span class="c1">// over-rides (if any) in non-production environments.</span>
<span class="lineno">23</span> <span class="nv">$conf_path</span> <span class="o">=</span> <span class="nx">DRUPAL_ROOT</span> <span class="o">.</span> <span class="s2">&quot;/sites/default/&quot;</span><span class="p">;</span>
<span class="lineno">24</span> <span class="k">require</span> <span class="nv">$conf_path</span> <span class="o">.</span> <span class="s2">&quot;settings.</span><span class="si">$environment</span><span class="s2">.php&quot;</span><span class="p">;</span>
<span class="lineno">25</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>Note this also lets you include a separate PHP file called “settings.dev.php” for development, where variable overrides (using global $conf) can be done on a per-environment basis.</p>

<h3 id="environment-switching">Environment switching</h3>

<p>A natural extension of the environment module is to allow pulling a production database back to development, and then “switching” it into a development state. This switching is already a hook you can implement, allowing you to react on both the current and target environments.</p>

<p>An example of this is from the module’s homepage:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * Implementation of hook_environment_switch().</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">HOOK_environment_switch</span><span class="p">(</span><span class="nv">$target_env</span><span class="p">,</span> <span class="nv">$current_env</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="c1">// Declare each optional development-related module</span>
<span class="lineno"> 7</span>   <span class="nv">$devel_modules</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 8</span>     <span class="s1">&#39;context_ui&#39;</span><span class="p">,</span>
<span class="lineno"> 9</span>     <span class="s1">&#39;devel&#39;</span><span class="p">,</span>
<span class="lineno">10</span>     <span class="s1">&#39;devel_generate&#39;</span><span class="p">,</span>
<span class="lineno">11</span>     <span class="s1">&#39;devel_node_access&#39;</span><span class="p">,</span>
<span class="lineno">12</span>     <span class="s1">&#39;update&#39;</span><span class="p">,</span>
<span class="lineno">13</span>     <span class="s1">&#39;views_ui&#39;</span><span class="p">,</span>
<span class="lineno">14</span>   <span class="p">);</span>
<span class="lineno">15</span>   <span class="k">switch</span> <span class="p">(</span><span class="nv">$target_env</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">16</span>     <span class="k">case</span> <span class="s1">&#39;production&#39;</span><span class="o">:</span>
<span class="lineno">17</span>       <span class="nx">module_disable</span><span class="p">(</span><span class="nv">$devel_modules</span><span class="p">);</span>
<span class="lineno">18</span>       <span class="nx">drupal_set_message</span><span class="p">(</span><span class="s1">&#39;Disabled development modules&#39;</span><span class="p">);</span>
<span class="lineno">19</span>       <span class="k">return</span><span class="p">;</span>
<span class="lineno">20</span>     <span class="k">case</span> <span class="s1">&#39;development&#39;</span><span class="o">:</span>
<span class="lineno">21</span>       <span class="nx">module_enable</span><span class="p">(</span><span class="nv">$devel_modules</span><span class="p">);</span>
<span class="lineno">22</span>       <span class="nx">drupal_set_message</span><span class="p">(</span><span class="s1">&#39;Enabled development modules&#39;</span><span class="p">);</span>
<span class="lineno">23</span>       <span class="k">return</span><span class="p">;</span>
<span class="lineno">24</span>   <span class="p">}</span>
<span class="lineno">25</span> <span class="p">}</span>
<span class="lineno">26</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>Other common things we do in our environment switch to development include:</p>

<p><strong>Removing JS and CSS aggregation</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> <span class="nx">variable_set</span><span class="p">(</span><span class="s1">&#39;preprocess_css&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="lineno">3</span> <span class="nx">variable_set</span><span class="p">(</span><span class="s1">&#39;preprocess_js&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="lineno">4</span> <span class="nx">drupal_set_message</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Removed aggregation from CSS and JS.&#39;</span><span class="p">));</span>
<span class="lineno">5</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p><strong>Changing the Apache Solr environment to point at localhost</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="k">if</span> <span class="p">(</span><span class="nx">module_exists</span><span class="p">(</span><span class="s1">&#39;apachesolr&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="lineno"> 3</span>   <span class="nv">$solr_env</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 4</span>     <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://127.0.0.1:8983/solr/dev&#39;</span><span class="p">,</span>
<span class="lineno"> 5</span>     <span class="s1">&#39;make_default&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<span class="lineno"> 6</span>     <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DEV&#39;</span><span class="p">,</span>
<span class="lineno"> 7</span>     <span class="s1">&#39;env_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;solr&#39;</span><span class="p">,</span>
<span class="lineno"> 8</span>     <span class="s1">&#39;service_class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="lineno"> 9</span>     <span class="s1">&#39;conf&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">10</span>       <span class="s1">&#39;apachesolr_read_only&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="lineno">11</span>     <span class="p">),</span>
<span class="lineno">12</span>   <span class="p">);</span>
<span class="lineno">13</span>   <span class="nx">apachesolr_environment_save</span><span class="p">(</span><span class="nv">$solr_env</span><span class="p">);</span>
<span class="lineno">14</span>   <span class="nx">drupal_set_message</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Set solr environment to @name at @url&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">15</span>     <span class="s1">&#39;@name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$solr_env</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<span class="lineno">16</span>     <span class="s1">&#39;@url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$solr_env</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span>
<span class="lineno">17</span>   <span class="p">)));</span>
<span class="lineno">18</span> <span class="p">}</span>
<span class="lineno">19</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p><strong>Preventing API writes to production systems</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">1</span> <span class="cp">&lt;?php</span>
<span class="lineno">2</span> <span class="nx">variable_set</span><span class="p">(</span><span class="s1">&#39;brightcove_api_write_enabled&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="lineno">3</span> <span class="nx">drupal_set_message</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Stopped the Brightcove write API sync.&#39;</span><span class="p">));</span>
<span class="lineno">4</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p><strong>Granting helpful debugging permissions to certain roles</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="k">if</span> <span class="p">(</span><span class="nx">module_exists</span><span class="p">(</span><span class="s1">&#39;devel&#39;</span><span class="p">))</span> <span class="p">{</span>
<span class="lineno"> 3</span>   <span class="nv">$dev_perms</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 4</span>     <span class="s1">&#39;access devel information&#39;</span><span class="p">,</span>
<span class="lineno"> 5</span>     <span class="s1">&#39;switch users&#39;</span><span class="p">,</span>
<span class="lineno"> 6</span>   <span class="p">);</span>
<span class="lineno"> 7</span>   <span class="nx">user_role_grant_permissions</span><span class="p">(</span><span class="nx">DRUPAL_ANONYMOUS_RID</span><span class="p">,</span> <span class="nv">$dev_perms</span><span class="p">);</span>
<span class="lineno"> 8</span>   <span class="nx">user_role_grant_permissions</span><span class="p">(</span><span class="nx">DRUPAL_AUTHENTICATED_RID</span><span class="p">,</span> <span class="nv">$dev_perms</span><span class="p">);</span>
<span class="lineno"> 9</span> <span class="p">}</span>
<span class="lineno">10</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>The list goes on here.</p>

<h2 id="environment-indicator-module">Environment indicator module</h2>

<p>Now that Drupal is environment aware, it is really helpful if Drupal can inform the user what environment they are currently looking at. Out of the box the environment module has no UI, so enter the module <a href="https://www.drupal.org/project/environment_indicator">environment indicator</a> to come save the day.</p>

<p>The new 7.x-2.x branch of environment indicator contains a lot of improvements over the 7.x-1.x branch, one of which is the integration with the core toolbar and shortcut modules.</p>

<p>To illustrate this, here is a screenshot of our toolbar in development (some links were stripped)</p>

<p><a href="http://www.pixelite.co.nz/img/toolbar.png">
<img src="http://www.pixelite.co.nz/img/toolbar.png" alt="Environment indicator and the toolbar module working together" class="img-responsive" />
</a></p>

<p>The module also alters the favicon to include a tiny letter and coloured background to match the colour you chose</p>

<p><img src="http://www.pixelite.co.nz/img/toolbar-icon.png" width="181" height="38" alt="Environment indicator and the favicon working together" /></p>

<p>This way you will never again forget which environment you are using, as the colours will be right there at the top of every page.</p>

<h2 id="comments">Comments</h2>

<p>I am keen to hear how other people solve the issue of environment aware Drupal applications, and how this is communicated to the end users of the application. What other modules are out there? What experiences have you had?</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/environment-aware-drupal-sites';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/how-create-dashboard-dashing-and-integrate-drupal-data" data-toggle="tooltip" data-placement="top" title="How to create a dashboard with Dashing and integrate with Drupal data">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/using-git-pre-commit-hooks-keep-you-drupal-codebase-clean" data-toggle="tooltip" data-placement="top" title="Using git pre-commit hooks to keep your Drupal codebase clean">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
