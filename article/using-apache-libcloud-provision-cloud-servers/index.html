<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Apache’s libcloud is a Python library that allows you to write code that interacts with numerous cloud service providers. From the big players like Amazon AWS, Google and Rackspace to even smaller local providers like the New Zealand based RimuHosting. A full list of supported providers  can be found here">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Using apache-libcloud to provision cloud servers - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    

<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="1282"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers"/>

    <!-- Post Header -->
    <header class="intro-header" style="background-image: url('/img/libcloud/libcloud2.png')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 itemprop="name headline">Using apache-libcloud to provision cloud servers</h1>
                        

                        <span class="meta">Posted by <a href="/authors/craig-pearson/" title="View Craig Pearson's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Craig Pearson</span></span></a> on <time datetime="2013-08-27T00:00:00" itemprop="datePublished">August 27, 2013</time></span>
                        <ul class="social-buttons cf">
                            <li>
                                <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Using apache-libcloud to provision cloud servers" data-url="http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                            </li>
                            <li>
                                <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers&amp;t=Using%20apache-libcloud%20to%20provision%20cloud%20servers" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                            </li>
                            <li>
                                <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers&amp;title=Using%20apache-libcloud%20to%20provision%20cloud%20servers" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p><a href="http://libcloud.apache.org/">Apache’s libcloud</a> is a Python library that allows you to write code that interacts with numerous cloud service providers. From the big players like <a href="http://aws.amazon.com">Amazon AWS</a>, <a href="https://cloud.google.com/products/compute-engine">Google</a> and <a href="http://www.rackspace.com/">Rackspace</a> to even smaller local providers like the New Zealand based <a href="http://rimuhosting.com/">RimuHosting</a>. A full list of supported providers  can be found <a href="https://ci.apache.org/projects/libcloud/docs/supported_providers.html#provider-matrix">here</a></p>

<p>The library is not limited to provisioning servers and supports a bunch of things like load balancing, storage and even DNS but here we’ll just focus on cloud server provisioning.</p>

<h3 id="installation">Installation</h3>

<p>I am assuming you are running Ubuntu or another Debian variant. if not check official installation instructions <a href="https://ci.apache.org/projects/libcloud/docs/getting_started.html">here</a>. Normally installation is as easy as:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install python-pip
sudo pip install apache-libcloud</code></pre></div>

<h3 id="getting-started">Getting started</h3>

<p>The library is designed to provide a common interface to the different cloud providers, the general process is.</p>

<ol>
  <li>Choose a provider</li>
  <li>Request a Driver for that provider</li>
  <li>Set credentials</li>
  <li>Run operations</li>
  <li>Continue or complete</li>
</ol>

<p>As an example, if I wanted to see the EC2 instance sizes that were available in Sydney I could do the following.</p>

<p>Include the required libraries:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">libcloud.compute.types</span> <span class="kn">import</span> <span class="n">Provider</span>
<span class="kn">from</span> <span class="nn">libcloud.compute.providers</span> <span class="kn">import</span> <span class="n">get_driver</span></code></pre></div>

<p>Request the AWS EC2 Sydney provider: (remember full list <a href="https://ci.apache.org/projects/libcloud/docs/supported_providers.html#compute">here</a>)</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cls</span> <span class="o">=</span> <span class="n">get_driver</span><span class="p">(</span><span class="n">Provider</span><span class="o">.</span><span class="n">EC2_AP_SOUTHEAST2</span><span class="p">)</span></code></pre></div>

<p>Set my credentials</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">driver</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">AWS_EC2_ACCESS_ID</span><span class="p">,</span> <span class="n">AWS_EC2_SECRET_KEY</span><span class="p">)</span></code></pre></div>

<p>Now I can request a list of node sizes</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sizes</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_sizes</span><span class="p">()</span>
<span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
<span class="k">print</span> <span class="n">size</span></code></pre></div>

<p><strong>NOTE:</strong> Remember to set the variables <strong>AWS_EC2_ACCESS_ID</strong> and <strong>AWS_EC2_SECRET_KEY</strong> to your API credentials.</p>

<p>The variable <strong>sizes</strong> now contains a list of all the available instance sizes in Sydney. Running that script would output something like so:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">t1.micro,</span> <span class="na">name=</span><span class="s">Micro</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">613</span> <span class="na">disk=</span><span class="s">15</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.02</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
        <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m1.small,</span> <span class="na">name=</span><span class="s">Small</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">1740</span> <span class="na">disk=</span><span class="s">160</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.085</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
            <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m1.medium,</span> <span class="na">name=</span><span class="s">Medium</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">3700</span> <span class="na">disk=</span><span class="s">410</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.17</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m1.large,</span> <span class="na">name=</span><span class="s">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">7680</span> <span class="na">disk=</span><span class="s">850</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.34</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m1.xlarge,</span> <span class="na">name=</span><span class="s">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">15360</span> <span class="na">disk=</span><span class="s">1690</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.68</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m2.xlarge,</span> <span class="na">name=</span><span class="s">High-Memory</span> <span class="err">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">17510</span> <span class="na">disk=</span><span class="s">420</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.506</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m2.2xlarge,</span> <span class="na">name=</span><span class="s">High-Memory</span> <span class="err">Double</span> <span class="err">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">35021</span> <span class="na">disk=</span><span class="s">850</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">1.012</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m2.4xlarge,</span> <span class="na">name=</span><span class="s">High-Memory</span> <span class="err">Quadruple</span> <span class="err">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">70042</span> <span class="na">disk=</span><span class="s">1690</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">2.024</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m3.xlarge,</span> <span class="na">name=</span><span class="s">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">15360</span> <span class="na">disk=</span><span class="s">None</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.7</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">m3.2xlarge,</span> <span class="na">name=</span><span class="s">Double</span> <span class="err">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">30720</span> <span class="na">disk=</span><span class="s">None</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">1.4</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                                            <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">c1.medium,</span> <span class="na">name=</span><span class="s">High-CPU</span> <span class="err">Medium</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">1740</span> <span class="na">disk=</span><span class="s">350</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.186</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span>
                                                <span class="nt">&lt;NodeSize:</span> <span class="na">id=</span><span class="s">c1.xlarge,</span> <span class="na">name=</span><span class="s">High-CPU</span> <span class="err">Extra</span> <span class="err">Large</span> <span class="err">Instance,</span> <span class="na">ram=</span><span class="s">7680</span> <span class="na">disk=</span><span class="s">1690</span> <span class="na">bandwidth=</span><span class="s">None</span> <span class="na">price=</span><span class="s">0.744</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span> <span class="err">...</span><span class="nt">&gt;</span></code></pre></div>

<p>Another helpful method is <strong>list_images()</strong> which returns a list of all the OS images that are available for our current driver (in this case just EC2 AMI’s in Sydney). Simply adding the following to the bottom of our script and running it again</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">images</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_images</span><span class="p">()</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
<span class="k">print</span> <span class="n">image</span></code></pre></div>

<p>Will output a the size list then a big list of the available node images like following (trimmed)</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml">[...]
    <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff69fec5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-lappstack-5.4.10-0-linux-ubuntu-12.04.1-x86_64-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
        <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff70e3c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-redmine-2.3.1-2-linux-ubuntu-12.04.2-x86_64-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
            <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff79eac5,</span> <span class="na">name=</span><span class="s">bitnami-cloud-ap-sydney/plone/bitnami-plone-4.3.1-0-linux-ubuntu-12.04.2-x86_64-s3.manifest.xml,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff7be9c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-reviewboard-1.7.12-1-linux-ubuntu-12.04.2-i386-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff8314c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-thinkup-1.1.1-0-linux-ubuntu-12.04.1-x86_64-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff8413c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-enanocms-1.1.8-1-linux-ubuntu-12.04.1-i386-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff8d1ac5,</span> <span class="na">name=</span><span class="s">919814621061/percona64-ubuntu1004-ap-southeast-2-1115-20121115131011,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff9301c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-jenkins-1.524-0-linux-ubuntu-12.04.2-i386-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ff9407c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-discourse-0.9.2.5-0-linux-ubuntu-12.04.2-i386-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;NodeImage:</span> <span class="na">id=</span><span class="s">ami-ffa434c5,</span> <span class="na">name=</span><span class="s">979382823631/bitnami-redmine-2.3.0-1-linux-ubuntu-12.04.2-x86_64-ebs,</span> <span class="na">driver=</span><span class="s">Amazon</span> <span class="err">EC2</span> <span class="err">(ap-southeast-2)</span>  <span class="err">...</span><span class="nt">&gt;</span>
                                            [...]</code></pre></div>

<p>One thing to note, is that these images and sizes are objects we need to pass through to the create methods, so if you know the size of Node you want unfortunately to make the library portable you cant just parse in the ID, you still need to get the <strong>NodeSize</strong> object you are after from the list, for example if you knew you wanted to create a ‘m1.small’ instance you’d have to do something like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">MY_SIZE</span> <span class="o">=</span> <span class="s">&#39;m1.small&#39;</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_sizes</span><span class="p">()</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sizes</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">MY_SIZE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></code></pre></div>

<p>Sets the <strong>size</strong> variable to</p>

<p><code>
    &lt;NodeSize: id=m1.small, name=Small Instance, ram=1740 disk=160 bandwidth=None price=0.085 driver=Amazon EC2 (ap-southeast-2) ...&gt;
</code></p>

<p>The same is true for your host’s <strong>NodeImage</strong> so lets update our script from before to specify a <strong>NodeSize</strong> and a <strong>NodeImage</strong>.</p>

<p>For this example I am going to use an AMI for an official Ubuntu Instance image in Sydney. This is for m1.small instances and is available in the Sydney pool of AMI’s. <strong>ami-934ddea9</strong>. You can see all the official Ubuntu ones <a href="https://help.ubuntu.com/community/EC2StartersGuide#Official_Ubuntu_Cloud_Guest_Amazon_Machine_Images_.28AMIs.29">here</a>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">libcloud.compute.types</span> <span class="kn">import</span> <span class="n">Provider</span>
<span class="kn">from</span> <span class="nn">libcloud.compute.providers</span> <span class="kn">import</span> <span class="n">get_driver</span>

<span class="n">cls</span> <span class="o">=</span> <span class="n">get_driver</span><span class="p">(</span><span class="n">Provider</span><span class="o">.</span><span class="n">EC2_AP_SOUTHEAST2</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">AWS_EC2_ACCESS_ID</span><span class="p">,</span> <span class="n">AWS_EC2_SECRET_KEY</span><span class="p">)</span>

<span class="n">MY_SIZE</span> <span class="o">=</span> <span class="s">&#39;m1.small&#39;</span>
<span class="n">MY_IMAGE</span> <span class="o">=</span> <span class="s">&#39;ami-934ddea9&#39;</span>

<span class="n">sizes</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_sizes</span><span class="p">()</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_images</span><span class="p">()</span>

<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sizes</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">MY_SIZE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">MY_IMAGE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">print</span> <span class="n">size</span>
<span class="k">print</span> <span class="n">image</span>

<span class="c"># Outputs</span>
<span class="c"># &lt;NodeSize: id=m1.small, name=Small Instance, ram=1740 disk=160 bandwidth=None price=0.085 driver=Amazon EC2 (ap-southeast-2) ...&gt;</span>
<span class="c"># &lt;NodeImage: id=ami-934ddea9, name=ubuntu-ap-southeast-2/images/ubuntu-precise-12.04-amd64-server-20130624.manifest.xml, driver=Amazon EC2 (ap-southeast-2)  ...&gt;</span></code></pre></div>

<p>Perfect, let’s continue.</p>

<h3 id="creating-an-instance">Creating an instance</h3>

<p>The libcloud library provides a <strong>create_node</strong> method that allows us to provide, a name, NodeSize and NodeImage parameters to fully provision a node. A call to this method could look like so</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">node</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;My Instance&quot;</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span></code></pre></div>

<p>This will create an EC2 instance called <strong>“My Instance”</strong></p>

<p>Simply adding that line to the bottom of our script will create an Amazon EC2 Instance. See:</p>

<p><img src="/img/libcloud/aws1.png" width="755" height="120" alt="" /></p>

<p>But that’s not much help, we really want to be able to set up some access (Key Pairs) and ensure that we have at least the SSH port open (Security Groups)</p>

<p>So in the AWS console set up a <strong>Key Pair</strong> and name it <strong>‘provision’</strong> and then create a <strong>Security group</strong> called <strong>‘ssh_access’</strong> and allow inbound SSH access. We can now update our script like so.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">libcloud.compute.types</span> <span class="kn">import</span> <span class="n">Provider</span>
<span class="kn">from</span> <span class="nn">libcloud.compute.providers</span> <span class="kn">import</span> <span class="n">get_driver</span>

<span class="n">cls</span> <span class="o">=</span> <span class="n">get_driver</span><span class="p">(</span><span class="n">Provider</span><span class="o">.</span><span class="n">EC2_AP_SOUTHEAST2</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">AWS_EC2_ACCESS_ID</span><span class="p">,</span> <span class="n">AWS_EC2_SECRET_KEY</span><span class="p">)</span>

<span class="n">ACCESS_KEY_NAME</span> <span class="o">=</span> <span class="s">&#39;provision&#39;</span>

<span class="n">SECURITY_GROUP_NAMES</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">SECURITY_GROUP_NAMES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;ssh_access&#39;</span><span class="p">)</span>

<span class="n">MY_SIZE</span> <span class="o">=</span> <span class="s">&#39;m1.small&#39;</span>
<span class="n">MY_IMAGE</span> <span class="o">=</span> <span class="s">&#39;ami-934ddea9&#39;</span>

<span class="n">sizes</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_sizes</span><span class="p">()</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">list_images</span><span class="p">()</span>

<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sizes</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">MY_SIZE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">MY_IMAGE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;My Instance&quot;</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
<span class="n">ex_keyname</span><span class="o">=</span><span class="n">ACCESS_KEY_NAME</span><span class="p">,</span> <span class="n">ex_securitygroup</span><span class="o">=</span><span class="n">SECURITY_GROUP_NAMES</span><span class="p">)</span>

<span class="k">print</span> <span class="n">node</span>
<span class="c"># outputs</span>
<span class="c"># &lt;Node: uuid=a1acbb69c58dd3936fc34ca070d6d72c029e2354, name=My Instance, state=3, public_ips=[], provider=Amazon EC2 (ap-southeast-2) ...&gt;</span></code></pre></div>

<p>This script will create a EC2 small instance, in Sydney, add the Public key to the authorized_keys file for root, and make sure that port 22 is open for connection.</p>

<p>You can now SSH into your server, check the AWS EC2 console for the publicly assigned DNS name to connect to.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ssh -l root ec2-54-252-210-134.ap-southeast-2.compute.amazonaws.com</code></pre></div>

<p><strong>NOTE:</strong> since we are running Ubuntu, you can’t SSH into the new box as <strong>root</strong> you need to use the user account <strong>ubuntu</strong>. If you do login with <strong>root</strong> you will be instructed about this.</p>

<p>So there we have it. Apache libcloud makes it really easy to provision servers.</p>

<p>There is a whole bunch of additional functionality we haven’t covered here. Executing commands on the server during provisioning for installation of software, adding public keys via the library and running other arbitrary shell commands. If you’re interested in knowing more feel free to leave a comment.</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/using-apache-libcloud-provision-cloud-servers';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/adding-additional-fields-using-custom-module-openerp-7" data-toggle="tooltip" data-placement="top" title="Adding additional fields using a custom module in OpenERP 7">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/using-gimps-foreground-select-tool" data-toggle="tooltip" data-placement="top" title="Using GIMP's Foreground select tool">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
