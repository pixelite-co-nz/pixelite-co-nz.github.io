<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <meta name="description" content="On a recent large Drupal project we were finding that the  table was holding around 4 MB of data. The issue of course with this is that this is loaded into memory on each page request regardless of whether or not you use it. Another issue is that the variable table holds serialized data, and there is an additional CPU overhead of actually de-serializing the data as well.">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- OpenGraph Tags -->
    <meta property="og:title" content="How to find and debug large variables in Drupal 7" />
    <meta property="og:site_name" content="Pixelite" />
    <meta property="og:url" content="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7/" />
    <meta property="og:description" content="" />
    <meta property="fb:app_id" content="410615979137383" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    
        <meta property="og:image" content="http://www.pixelite.co.nz/img/default.png" />
    

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@pixelite_">
    
        <meta name="twitter:creator" content="@wiifm">
    
    <meta name="twitter:title" content="How to find and debug large variables in Drupal 7">
    <meta name="twitter:description" content="">
    
        <meta name="twitter:image" content="http://www.pixelite.co.nz/img/default.png">
    


    <title>How to find and debug large variables in Drupal 7 - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    
<!-- Main Content -->
<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="593"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7"/>

    <header class="intro-header" style="background-image: url('/')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1 itemprop="name headline">How to find and debug large variables in Drupal 7</h1>
                    

                    <span class="meta">Posted by <a href="/authors/sean-hamlin/" title="View Sean Hamlin's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span></a> on <time datetime="2013-05-22T00:00:00" itemprop="datePublished">May 22, 2013</time></span>
                    <ul class="social-buttons cf">
                        <li>
                            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="How to find and debug large variables in Drupal 7" data-url="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                        </li>
                        <li>
                            <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                        </li>
                        <li>
                            <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7&amp;t=How%20to%20find%20and%20debug%20large%20variables%20in%20Drupal%207" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                        </li>
                        <li>
                            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7&amp;title=How%20to%20find%20and%20debug%20large%20variables%20in%20Drupal%207" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>On a recent large Drupal project we were finding that the  table was holding around 4 MB of data. The issue of course with this is that this is loaded into memory on each page request regardless of whether or not you use it. Another issue is that the variable table holds serialized data, and there is an additional CPU overhead of actually de-serializing the data as well.</p>

<h2 id="introducing-variable-debug">Introducing Variable debug</h2>

<p>So I wrote a module <a href="http://drupal.org/project/variable_debug" title="A link to the module on Drupal.org">Variable debug</a> that is a straight forward and simple module that attempts to do only two things (at the moment):</p>

<ol>
  <li>
    <p>A list of the highest memory usage variables stored in the {variable} table sorted by highest to lowest. There is also a list of links to Drupal.org issues to help resolve some known high usage offenders. If you know of an issue that exists that aims to resolve in-efficient usage of the variable table, please raise a new issue in the issue queue for this module.</p>
  </li>
  <li>
    <p>A list of all suspected orphaned variables in the variable table. This is determined by whether or not the variable is:</p>
    <ol>
      <li>Not a variable provided by Drupal core</li>
      <li>Does not start with an enabled module name</li>
    </ol>

    <p>This can help you find and remove potential abandoned variables that are of no use to you and your site.</p>
  </li>
</ol>

<h2 id="symptoms-of-rogue-variables">Symptoms of rogue variables</h2>

<p>Sometimes Drupal contributed modules use the variable table as a dumping ground for large variables that really should be stored in dedicated tables. Here is an example from one of our websites using the SQL query:</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">LENGTH</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">AS</span> <span class="k">length</span><span class="p">,</span> <span class="n">name</span> <span class="k">FROM</span> <span class="k">variable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">length</span> <span class="k">ASC</span><span class="p">;</span></code></pre></div>

<p>And the end of the result:</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="o">|</span>    <span class="mi">534</span> <span class="o">|</span> <span class="n">hs_config_taxonomy</span><span class="o">-</span><span class="mi">17</span>                                           <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">551</span> <span class="o">|</span> <span class="n">subscription_mail_status_activated_body</span>                         <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">561</span> <span class="o">|</span> <span class="n">hs_config_taxonomy</span><span class="o">-</span><span class="mi">13</span>                                           <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">573</span> <span class="o">|</span> <span class="n">googleanalytics_custom_var</span>                                      <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">580</span> <span class="o">|</span> <span class="n">article_import_known_columnists</span>                                 <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">600</span> <span class="o">|</span> <span class="n">menu_masks</span>                                                      <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">617</span> <span class="o">|</span> <span class="n">order_completion_text_digital_auth</span>                              <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">620</span> <span class="o">|</span> <span class="n">menu_default_active_menus</span>                                       <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">622</span> <span class="o">|</span> <span class="n">order_completion_text_corporate_auth</span>                            <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">626</span> <span class="o">|</span> <span class="n">user_mail_register_no_approval_required_body</span>                    <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">638</span> <span class="o">|</span> <span class="n">menu_minipanels_hover</span>                                           <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">660</span> <span class="o">|</span> <span class="n">field_bundle_settings_node__page</span>                                <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">666</span> <span class="o">|</span> <span class="n">article_import_known_agencies</span>                                   <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">700</span> <span class="o">|</span> <span class="n">field_bundle_settings_node__collection</span>                          <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">702</span> <span class="o">|</span> <span class="n">field_bundle_settings_node__article</span>                             <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">733</span> <span class="o">|</span> <span class="n">order_completion_text_print_auth</span>                                <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">781</span> <span class="o">|</span> <span class="n">field_bundle_settings_node__promotion</span>                           <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">869</span> <span class="o">|</span> <span class="n">order_completion_text_digital</span>                                   <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">903</span> <span class="o">|</span> <span class="n">subscription_activation_text_unverified</span>                         <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">939</span> <span class="o">|</span> <span class="n">order_completion_text_print</span>                                     <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">955</span> <span class="o">|</span> <span class="n">order_completion_text_corporate</span>                                 <span class="o">|</span>
    <span class="o">|</span>    <span class="mi">991</span> <span class="o">|</span> <span class="n">field_bundle_settings_node__subscription</span>                        <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">1012</span> <span class="o">|</span> <span class="n">subscription_activation_text_pending</span>                            <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">1073</span> <span class="o">|</span> <span class="n">field_bundle_settings_commerce_product__subscription_product</span>    <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">1278</span> <span class="o">|</span> <span class="n">entityreference</span><span class="p">:</span><span class="n">base</span><span class="o">-</span><span class="n">tables</span>                                     <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">1783</span> <span class="o">|</span> <span class="n">high_risk_districts</span>                                             <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">1988</span> <span class="o">|</span> <span class="n">commerce_enabled_currencies</span>                                     <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">2356</span> <span class="o">|</span> <span class="n">metered_useragent_whitelist</span>                                     <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">2515</span> <span class="o">|</span> <span class="n">rules_empty_sets</span>                                                <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">2796</span> <span class="o">|</span> <span class="n">apachesolr_index_last</span>                                           <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">3178</span> <span class="o">|</span> <span class="n">memcache_wildcard_flushes</span>                                       <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">3673</span> <span class="o">|</span> <span class="n">drupal_js_cache_files</span>                                           <span class="o">|</span>
    <span class="o">|</span>   <span class="mi">7804</span> <span class="o">|</span> <span class="n">features_codecache</span>                                              <span class="o">|</span>
    <span class="o">|</span>  <span class="mi">14840</span> <span class="o">|</span> <span class="n">drupal_css_cache_files</span>                                          <span class="o">|</span>
    <span class="o">|</span> <span class="mi">852329</span> <span class="o">|</span> <span class="n">imagefield_crop_info</span>                                            <span class="o">|</span>
    <span class="o">+</span><span class="c1">--------+-----------------------------------------------------------------+</span>
    <span class="mi">1207</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span></code></pre></div>

<p>Anything over several hundred bytes in the variable table really has to take a step back any look at better utilising cache tables.</p>

<h2 id="integration-with-drupalorg-issues">Integration with Drupal.org issues</h2>

<p>The next feature I added to the module was known large variables, and links to Drupal.org issue queue items that contain patches to resolve the large memory usage.</p>

<p>Here is a screenshot showing the functionality.</p>

<p><img src="/img/debug/Selection_048.png" alt="Screenshot of the functionality showing links to Drupal.org issues" /></p>

<h2 id="questions">Questions</h2>

<p>Let me know in the comments if this helps you, also if you have any other known rogue variables that have Drupal.org issues, that would also be welcome.</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/how-find-and-debug-large-variables-drupal-7';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/how-computers-see-simple-introduction-computer-vision" data-toggle="tooltip" data-placement="top" title="How computers see. A simple introduction to computer vision">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/practical-example-converting-drupal-7-module-work-drupal-8" data-toggle="tooltip" data-placement="top" title="A practical example for converting a Drupal 7 module to work with Drupal 8">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>



    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
