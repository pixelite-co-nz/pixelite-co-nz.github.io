<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Often on Drupal sites you need the ability to create re-usable panel panes for use on the site. Each panel pane would need custom configuration, and could even be context aware (aware of were they are placed on the site).">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Building custom content panes (aka ctools content types) in panels 3, and Drupal 7 - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" width="180" height="60" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    

<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="1188"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7"/>

    <!-- Post Header -->
    <header class="intro-header" style="background-image: url('/img/post-bg-pane.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 itemprop="name headline">Building custom content panes (aka ctools content types) in panels 3, and Drupal 7</h1>
                        
                        <h2 class="subheading" itemprop="description">Custom panes > blocks</h2>
                        

                        <span class="meta">Posted by <a href="/authors/sean-hamlin/" title="View Sean Hamlin's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span></a> on <time datetime="2012-10-14T00:00:00" itemprop="datePublished">October 14, 2012</time></span>
                        <ul class="social-buttons cf">
                            <li>
                                <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Building custom content panes (aka ctools content types) in panels 3, and Drupal 7" data-url="http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                            </li>
                            <li>
                                <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7&amp;t=Building%20custom%20content%20panes%20(aka%20ctools%20content%20types)%20in%20panels%203,%20and%20Drupal%207" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                            </li>
                            <li>
                                <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7&amp;title=Building%20custom%20content%20panes%20(aka%20ctools%20content%20types)%20in%20panels%203,%20and%20Drupal%207" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>Often on Drupal sites you need the ability to create re-usable panel panes for use on the site. Each panel pane would need custom configuration, and could even be context aware (aware of were they are placed on the site).</p>

<p>This is where ctools content types comes in. Ctools content types are one type of plugin that the ctools module provides. Out of the box, the ctools module provides a few content types to support core modules. These can be found in the <a href="http://cgit.drupalcode.org/ctools/tree/plugins/content_types?id=7.x-1.x">git repository</a>.</p>

<h2 id="advantages-of-ctools-content-types-versus-blocks">Advantages of ctools content types versus blocks</h2>

<ul><li>You do not need administer blocks permission (which is very risky for content authors to have)</li><li>Tight integration with panels and other panelizer. Using panelizer affords you the option of not giving away the 'administer panels' permission</li><li>Custom configuration edit forms to allow the panes to be re-usable and to make sense for your content authors</li><li>Developers can abstract away any complexity in code, leaving the content authors with only the job of adding the pane and configuring it</li></ul>
<p>Unfortunately there is not a lot of documentation around content types, so I will go through a simple example with you.</p>
<h2>Example implementation of ctools content type plugin</h2>
<p>In this example I will go through creating a custom twitter timeline widget that can be configured to pull through a selected user's tweets, and with an option for limiting the number displayed.</p>
<h3>Step 1: Create a new custom module with this in the .module file:</h3>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * Implements hook_ctools_plugin_directory().</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">examplemodule_ctools_plugin_directory</span><span class="p">(</span><span class="nv">$owner</span><span class="p">,</span> <span class="nv">$plugin_type</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="k">if</span> <span class="p">(</span><span class="nv">$owner</span> <span class="o">==</span> <span class="s1">&#39;ctools&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$plugin_type</span> <span class="o">==</span> <span class="s1">&#39;content_types&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 7</span>     <span class="k">return</span> <span class="s1">&#39;plugins/&#39;</span> <span class="o">.</span> <span class="nv">$plugin_type</span><span class="p">;</span>
<span class="lineno"> 8</span>   <span class="p">}</span>
<span class="lineno"> 9</span> <span class="p">}</span>
<span class="lineno">10</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>Where the name of my custom module is 'examplemodule'.</p>
<p>This lets ctools know that any file in the folder 'plugins/content_types/' should be parsed for content type plugins. This also keeps your code really nice.</p>

<h3>Step 2: Create the include file for the plugin</h3>

<pre><code>mkdir -p plugins/content_types
cd plugins/content_types
vim twitter_timeline.inc
</code></pre>

<p>Notice the directory structure matches what was declared in the .module file.</p>

<h3 id="step-3-declare-the-plugin-to-ctools">Step 3: Declare the plugin to ctools</h3>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="nv">$plugin</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 3</span>   <span class="s1">&#39;single&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<span class="lineno"> 4</span>   <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Twitter timeline&#39;</span><span class="p">),</span>
<span class="lineno"> 5</span>   <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Shows a twitter timeline with basic configuration options.&#39;</span><span class="p">),</span>
<span class="lineno"> 6</span>   <span class="s1">&#39;category&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Social media&#39;</span><span class="p">),</span>
<span class="lineno"> 7</span>   <span class="s1">&#39;edit form&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;examplemodule_twitter_timeline_edit_form&#39;</span><span class="p">,</span>
<span class="lineno"> 8</span>   <span class="s1">&#39;render callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;examplemodule_twitter_timeline_render&#39;</span><span class="p">,</span>
<span class="lineno"> 9</span>   <span class="s1">&#39;admin info&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;examplemodule_twitter_timeline_admin_info&#39;</span><span class="p">,</span>
<span class="lineno">10</span>   <span class="s1">&#39;defaults&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">11</span>     <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;wiifm&#39;</span><span class="p">,</span>
<span class="lineno">12</span>     <span class="s1">&#39;tweets_to_show&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
<span class="lineno">13</span>   <span class="p">)</span>
<span class="lineno">14</span> <span class="p">);</span>
<span class="lineno">15</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>This piece of code lets ctools know what functions to call, what argument defaults there are and so fourth. It should be largely self explanatory. It also means that your pane will show up in panels now, as we can see from this picture:</p>

<p><img alt="" class="img-responsive img-thumbnail" height="331" width="324" src="/img/drupal-pane/ctools-content-type-add.png" /></p>

<h3 id="step-4-implementing-admininfo">Step 4: Implementing admin_info</h3>

<p>Admin information is an optional function to implement that helps describe the pane when it is included on a panel. I would recomment always implementing it so your content authors can always see at a glance what configuration a particular pane has.</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * &#39;admin info&#39; callback for panel pane.</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">examplemodule_twitter_timeline_admin_info</span><span class="p">(</span><span class="nv">$subtype</span><span class="p">,</span> <span class="nv">$conf</span><span class="p">,</span> <span class="nv">$contexts</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$conf</span><span class="p">))</span> <span class="p">{</span>
<span class="lineno"> 7</span>     <span class="nv">$block</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
<span class="lineno"> 8</span>     <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;override_title&#39;</span><span class="p">]</span> <span class="o">?</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;override_title_text&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="lineno"> 9</span>     <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Showing @tweets_to_show tweets from &lt;em&gt;@@username&lt;/em&gt;.&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">10</span>       <span class="s1">&#39;@tweets_to_show&#39;</span> <span class="o">=&gt;</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;tweets_to_show&#39;</span><span class="p">],</span>
<span class="lineno">11</span>       <span class="s1">&#39;@username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
<span class="lineno">12</span>     <span class="p">));</span>
<span class="lineno">13</span>     <span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
<span class="lineno">14</span>   <span class="p">}</span>
<span class="lineno">15</span> <span class="p">}</span>
<span class="lineno">16</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>This is what the pane will look like after being configured</p>

<p><img alt="" class="img-responsive img-thumbnail" height="162" width="434" src="/img/drupal-pane/ctools-content-type-admin-info.png" /></p>

<h3>Step 5: Implementing the edit form</h3>

<p>The heart of ctools content types is the ability to create simple configuration forms for your content authors so they can easily create and edit panes. Edit forms use standard form API, so they are really easy to make</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * &#39;Edit form&#39; callback for the content type.</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">examplemodule_twitter_timeline_edit_form</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="nv">$conf</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">];</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>   <span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno"> 9</span>     <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Twitter username&#39;</span><span class="p">),</span>
<span class="lineno">10</span>     <span class="s1">&#39;#description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;The username of the twitter account in which to pull the tweets from.&#39;</span><span class="p">),</span>
<span class="lineno">11</span>     <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;textfield&#39;</span><span class="p">,</span>
<span class="lineno">12</span>     <span class="s1">&#39;#default_value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
<span class="lineno">13</span>     <span class="s1">&#39;#required&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<span class="lineno">14</span>   <span class="p">);</span>
<span class="lineno">15</span> 
<span class="lineno">16</span>   <span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;tweets_to_show&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<span class="lineno">17</span>     <span class="s1">&#39;#title&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Number of tweets to show&#39;</span><span class="p">),</span>
<span class="lineno">18</span>     <span class="s1">&#39;#description&#39;</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Used to control the number of tweets shown on the page initially. Defaults to 5.&#39;</span><span class="p">),</span>
<span class="lineno">19</span>     <span class="s1">&#39;#type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;select&#39;</span><span class="p">,</span>
<span class="lineno">20</span>     <span class="s1">&#39;#options&#39;</span> <span class="o">=&gt;</span> <span class="nx">drupal_map_assoc</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
<span class="lineno">21</span>     <span class="s1">&#39;#default_value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;tweets_to_show&#39;</span><span class="p">],</span>
<span class="lineno">22</span>     <span class="s1">&#39;#required&#39;</span> <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">,</span>
<span class="lineno">23</span>   <span class="p">);</span>
<span class="lineno">24</span> 
<span class="lineno">25</span>   <span class="k">return</span> <span class="nv">$form</span><span class="p">;</span>
<span class="lineno">26</span> <span class="p">}</span>
<span class="lineno">27</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>In order to save the configuration back to the $conf storage for the pane, you will also need a submit handler</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * The submit form stores the data in $conf.</span>
<span class="lineno"> 4</span> <span class="sd"> */</span>
<span class="lineno"> 5</span> <span class="k">function</span> <span class="nf">examplemodule_twitter_timeline_edit_form_submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="nv">$form_state</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>   <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;defaults&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 7</span>     <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
<span class="lineno"> 8</span>       <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">][</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$form_state</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="nv">$key</span><span class="p">];</span>
<span class="lineno"> 9</span>     <span class="p">}</span>
<span class="lineno">10</span>   <span class="p">}</span>
<span class="lineno">11</span> <span class="p">}</span>
<span class="lineno">12</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>There you have it, now you can configure the pane username, and the amount of tweets to show, all of which have sane defaults and helpful descriptions for your content authors. This is what this step looks like:</p>

<p><img alt="" class="img-responsive img-thumbnail" height="345" width="524" src="/img/drupal-pane/ctools-content-type-edit.png" /></p>

<h3>Step 6: Implemeting the render callback</h3>
<p>This is the guts of the pane, and is responsible for producing markup to be rendered on the page. I have taken a simplitest approach to this and have not used a theme function (and template), in reality I would encourage this as well.</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="cp">&lt;?php</span>
<span class="lineno"> 2</span> <span class="sd">/**</span>
<span class="lineno"> 3</span> <span class="sd"> * Run-time rendering of the body of the block (content type)</span>
<span class="lineno"> 4</span> <span class="sd"> * See ctools_plugin_examples for more advanced info</span>
<span class="lineno"> 5</span> <span class="sd"> */</span>
<span class="lineno"> 6</span> <span class="k">function</span> <span class="nf">examplemodule_twitter_timeline_render</span><span class="p">(</span><span class="nv">$subtype</span><span class="p">,</span> <span class="nv">$conf</span><span class="p">,</span> <span class="nv">$panel_args</span><span class="p">,</span> <span class="nv">$context</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 7</span>   <span class="nv">$block</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>   <span class="c1">// initial content is blank</span>
<span class="lineno">10</span>   <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="lineno">11</span>   <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="lineno">12</span> 
<span class="lineno">13</span>   <span class="c1">// Include twitter javascript - by linking to the external file.</span>
<span class="lineno">14</span>   <span class="nx">drupal_add_js</span><span class="p">(</span><span class="s1">&#39;//widgets.twimg.com/j/2/widget.js&#39;</span><span class="p">,</span> <span class="s1">&#39;external&#39;</span><span class="p">);</span>
<span class="lineno">15</span> 
<span class="lineno">16</span>   <span class="c1">// Add in the content</span>
<span class="lineno">17</span>   <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">.=</span> <span class="s1">&#39;</span>
<span class="lineno">18</span> <span class="s1">    &lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="lineno">19</span> <span class="s1">      var t = new TWTR.Widget({</span>
<span class="lineno">20</span> <span class="s1">        version: 2,</span>
<span class="lineno">21</span> <span class="s1">        type: &quot;profile&quot;,</span>
<span class="lineno">22</span> <span class="s1">        rpp: &#39;</span> <span class="o">.</span> <span class="nx">check_plain</span><span class="p">(</span><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;tweets_to_show&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;,</span>
<span class="lineno">23</span> <span class="s1">        interval: 30000,</span>
<span class="lineno">24</span> <span class="s1">        width: &quot;300&quot;,</span>
<span class="lineno">25</span> <span class="s1">        height: &quot;300&quot;,</span>
<span class="lineno">26</span> <span class="s1">        theme: {</span>
<span class="lineno">27</span> <span class="s1">          shell: {</span>
<span class="lineno">28</span> <span class="s1">            background: &quot;#ededed&quot;,</span>
<span class="lineno">29</span> <span class="s1">            color: &quot;#6a6a6a&quot;</span>
<span class="lineno">30</span> <span class="s1">          },</span>
<span class="lineno">31</span> <span class="s1">          tweets: {</span>
<span class="lineno">32</span> <span class="s1">            background: &quot;#fafafa&quot;,</span>
<span class="lineno">33</span> <span class="s1">            color: &quot;#6a6a6a&quot;,</span>
<span class="lineno">34</span> <span class="s1">            links: &quot;#6a6a6a&quot;</span>
<span class="lineno">35</span> <span class="s1">          }</span>
<span class="lineno">36</span> <span class="s1">        },</span>
<span class="lineno">37</span> <span class="s1">        features: {</span>
<span class="lineno">38</span> <span class="s1">          avatars: false,</span>
<span class="lineno">39</span> <span class="s1">          hashtags: true,</span>
<span class="lineno">40</span> <span class="s1">          scrollbar: false,</span>
<span class="lineno">41</span> <span class="s1">          loop: true,</span>
<span class="lineno">42</span> <span class="s1">          live: true,</span>
<span class="lineno">43</span> <span class="s1">          behavior: &quot;default&quot;</span>
<span class="lineno">44</span> <span class="s1">        }</span>
<span class="lineno">45</span> <span class="s1">      });</span>
<span class="lineno">46</span> 
<span class="lineno">47</span> <span class="s1">      t.render().setUser(&quot;&#39;</span> <span class="o">.</span> <span class="nx">check_plain</span><span class="p">(</span><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;&quot;).start();</span>
<span class="lineno">48</span> <span class="s1">    &lt;/script&gt;&#39;</span><span class="p">;</span>
<span class="lineno">49</span> 
<span class="lineno">50</span>   <span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
<span class="lineno">51</span> <span class="p">}</span>
<span class="lineno">52</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>Here is a sample panel page, with the twitter timelien pane on the right hand side</p>

<p><a href="/img/drupal-pane/ctools-content-type-page-1.png" target="_blank"><img alt="" class="img-responsive img-thumbnail" height="559" style="width: 600px; height: 428px;" width="783" src="/img/drupal-pane/ctools-content-type-page-1.png" /></a></p>

<p>And as you can imagine, it is relatively easy to add more panes onto the panel, here is another on the same page</p>

<p><a href="/img/drupal-pane/ctools-content-type-page-2.png" target="_blank"><img alt="" class="img-responsive img-thumbnail" height="645" style="width: 199px; height: 400px;" width="321" src="/img/drupal-pane/ctools-content-type-page-2.png" /></a></p>

<h2>Full module download</h2>

<p>I thought this post might be a bit code heavy, so I decided to <a href="http://dl.dropbox.com/u/759954/pixelite/examplemodule.tar.gz" target="_blank">include the full source of the module</a> in case you want to download and install it yourself. Feel free to rename it, extend it, do what you want with it.</p>
<h2>Final thoughts</h2>
<p>In this tutorial you have seen how easy it is to make a fully custom ctools content type plugin, from scratch. And hopefully begin to see how this is more powerful then traditional blocks.</p>
<p>What are your experiences with ctools content types, and helpful advice for others? Did this tutorial help you at all? Let me know in the comments.</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/building-custom-content-panes-aka-ctools-content-types-panels-3-and-drupal-7';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/remote-debugging-chrome-and-android" data-toggle="tooltip" data-placement="top" title="Remote debugging with Chrome and Android">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/setting-ubuntu-use-inconsolata" data-toggle="tooltip" data-placement="top" title="Setting up Ubuntu to use inconsolata">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
