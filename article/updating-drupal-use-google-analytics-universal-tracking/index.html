<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="So Google Analytics has a new version of Google Analytics dubbed “Universal Analytics”, which has a bunch of new features, that could be handy for your website. I would dive into exactly what they are here, as you can read about them on Google’s own website.">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Updating Drupal to use Google Analytics Universal tracking - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" width="180" height="60" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    

<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="566"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking"/>

    <!-- Post Header -->
    <header class="intro-header" style="background-image: url('/')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 itemprop="name headline">Updating Drupal to use Google Analytics Universal tracking</h1>
                        

                        <span class="meta">Posted by <a href="/authors/sean-hamlin/" title="View Sean Hamlin's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span></a> on <time datetime="2014-01-07T00:00:00" itemprop="datePublished">January 7, 2014</time></span>
                        <ul class="social-buttons cf">
                            <li>
                                <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Updating Drupal to use Google Analytics Universal tracking" data-url="http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                            </li>
                            <li>
                                <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking&amp;t=Updating%20Drupal%20to%20use%20Google%20Analytics%20Universal%20tracking" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                            </li>
                            <li>
                                <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking&amp;title=Updating%20Drupal%20to%20use%20Google%20Analytics%20Universal%20tracking" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>So Google Analytics has a new version of Google Analytics dubbed “Universal Analytics”, which has a bunch of new features, that could be handy for your website. I would dive into exactly what they are here, as you can read about them on <a href="https://support.google.com/analytics/answer/2790010?hl=en">Google’s own website</a>.</p>

<p>In this post I will go through the steps to upgrade the Google Analytics 7.x-1.x module to the new 7.x-2.x version that supports Universal Analytics.</p>

<h2 id="update-the-drupal-module">Update the Drupal module</h2>

<p>If you read the <a href="https://www.drupal.org/project/google_analytics">Google Analytics module page</a> you will spot that there are two different branches in use, in order to get the correct version you will need to get the 7.x-2.x version.</p>

<p>You can do this with Drush:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">drush dl google_analytics
drush updb</code></pre></div>

<h2 id="event-tracking">Event tracking</h2>

<p>If you have used custom event tracking in your website, a few changes are required.</p>

<p>Instead of</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_gaq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;_trackEvent&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;opt_label&#39;</span><span class="p">,</span> <span class="nx">opt_value</span><span class="p">,</span> <span class="nx">opt_noninteraction</span><span class="p">]);</span></code></pre></div>

<p>It is now</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;opt_label&#39;</span><span class="p">,</span> <span class="nx">opt_value</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;nonInteraction&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span></code></pre></div>

<h3 id="handy-grep-command">Handy grep command</h3>

<p>If you want to find the offending lines of code, you can use grep</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">grep -nrI <span class="s2">&quot;_trackEvent&quot;</span> *</code></pre></div>

<h2 id="custom-variables-are-now-dimensions-and-metrics">Custom variables are now dimensions and metrics</h2>

<p>If you were using the old style custom variables, these are now completely gone, now replaced with dimensions and metrics. You can <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/custom-dims-mets">read more about these on Google’s website</a>.</p>

<p>Instead of</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_gaq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;_setCustomVar&#39;</span><span class="p">,</span>
  <span class="mi">1</span><span class="p">,</span>                           <span class="c1">// Slot</span>
  <span class="s1">&#39;Customer Type&#39;</span><span class="p">,</span>             <span class="c1">// Name</span>
  <span class="s1">&#39;Paid&#39;</span><span class="p">,</span>                      <span class="c1">// Value</span>
  <span class="mi">1</span>                            <span class="c1">// Scope (1 = User scope)</span>
<span class="p">]);</span></code></pre></div>

<p>It is now</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;dimension1&#39;</span><span class="p">,</span> <span class="s1">&#39;Paid&#39;</span><span class="p">);</span></code></pre></div>

<h3 id="drupal-support-of-custom-dimensions-and-metrics">Drupal support of custom dimensions and metrics</h3>

<p>The Drupal module has an active issue that allows you to configure this through the UI, <del>unfortunately this is still only a patch at the moment, but is looking likely to be committed shortly<del>.</del></del></p>

<p>Update 24 July 2014 - this is now bundled into the latest stable release now.</p>

<h2 id="doubleclick-data">DoubleClick data</h2>

<p>If you were using the additional data that DoubleClick integration provided, this is now supported, this is just a tickbox on the admin settings page.</p>

<p>To enable it</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">variable_set(&#39;googleanalytics_trackdoubleclick&#39;, 1)</span></code></pre></div>

<h2 id="other-new-features-in-universal-analytics">Other new features in Universal Analytics</h2>

<h3 id="userid-tracking">UserID tracking</h3>

<p>This effectively allows you to track the same user across multiple devices. This comes in handy if your users can login to your Drupal site, and they would likely login on their mobile phones, and tablets etc. You can read more on <a href="https://support.google.com/analytics/answer/3123663">Google’s page about User ID tracking</a></p>

<p>To enable it</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">variable_set(&#39;googleanalytics_trackuserid&#39;, 1)</span></code></pre></div>

<h3 id="enhanced-link-attribution-feature">Enhanced Link Attribution feature</h3>

<p>Allows Google Analytics to differentiate URLs based on what link the user clicked on, really handy if you have many links pointing at the same page. You can read more on <a href="https://support.google.com/analytics/answer/2558867">Google’s page about User ID tracking</a></p>

<p>To enable it</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">variable_set(&#39;googleanalytics_tracklinkid&#39;, 1)</span></code></pre></div>

<h2 id="finally">Finally</h2>

<p>Run this little gem over your codebase to ensure there are no legacy Google Analytics code lying around.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">grep -nrI <span class="s2">&quot;_gaq&quot;</span> *</code></pre></div>

<p>Let me know if you have any tips or tricks in the comments for the new Google Analytics</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/updating-drupal-use-google-analytics-universal-tracking';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/sql-injection-and-drupal-7-top-1-10-owasp-security-risks" data-toggle="tooltip" data-placement="top" title="SQL injection and Drupal 7 - top 1 of 10 OWASP security risks">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/upgrading-php-54-ubuntu-1204-lts-support-drupal-8" data-toggle="tooltip" data-placement="top" title="Upgrading PHP to 5.4 on Ubuntu 12.04 LTS to support Drupal 8">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
