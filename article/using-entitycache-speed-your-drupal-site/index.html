<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <meta name="description" content="As you are aware Drupal likes to query the database, a lot. On complex pages it is not uncommon to have over 1,000 database queries occur. With the introduction of fields into Drupal 7, now in order to fully load a node, Drupal now also needs to join across many tables. Quickly you can see there being a scalability issue here.Luckily with Drupal 7, there is a pluggable caching and entity loading system. This means you can replace Drupal's default entity loading mechanism with another. Out of the box, entitycache replaces the caching mechanism for core entities:commentfilenodetaxonomy_termtaxonomy_vocabularyuserUnder the hoodWhat entitycache is doing behind the scenes is writting the completely loaded entities to a caching table (cache_entity_[entity-type]). The selects from these tables is inherantly faster than stock Drupal's joining across many tables.Real life example page speedOn a complex site I am building now, one of the nodes, has another 12 nodes listed on there (this is currently done with EntityFieldQuery, but it could just as easily been views). Here are some metrics:No entitycache, page loadedâ€‹ first thing after a clear cacheExecuted 1590 queries in 1897.61 ms. Queries exceeding 5 ms are highlighted. Page execution time was 6728.64 ms. Memory used at: devel_boot()=8.95 MB, devel_shutdown()=144.97 MB, PHP peak=146.5 MB.No entitycache, cache primedExecuted 508 queries in 628.06 ms. Queries exceeding 5 ms are highlighted. Page execution time was 1799.17 ms. Memory used at: devel_boot()=9.31 MB, devel_shutdown()=89.94 MB, PHP peak=90.75 MB.Now we add entitycache.With entitycache, page loaded first thing after a clear cacheExecuted 1624 queries in 1964.65 ms. Queries exceeding 5 ms are highlighted. Page execution time was 6768.48 ms. Memory used at: devel_boot()=8.95 MB, devel_shutdown()=145.17 MB, PHP peak=146.75 MB.With entitycache, cache primedExecuted 396 queries in 564.3 ms. Queries exceeding 5 ms are highlighted. Page execution time was 1680.65 ms. Memory used at: devel_boot()=7.96 MB, devel_shutdown()=89.57 MB, PHP peak=90.5 MB.As you can see entitycache adds an initial overhead in order to populate the cache tables, but once this is done, all subsequent entity loads are much faster, and there is less database traffic overall (22% less SQL queries).Real life entity loading speedTo load 12 nodes using entitycache (this query was taken from the above page generation):SELECT cid, data, created, expire, serialized FROM cache_entity_node WHERE cid IN ('4370', '122', '2828', '120', '3648', '3045', '4356', '3642', '3379', '3067', '107', '4376')Takes 18.34ms.How to install entitycacheSimple with drush, I run the development build as it contains a number of new features and fixes.drush dl entitycache-7.x-1.x-devdrush en entitycache -yIf you have any success stories, let me know in the comments.">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- OpenGraph Tags -->
    <meta property="og:title" content="Using EntityCache to speed up your Drupal site" />
    <meta property="og:site_name" content="Pixelite" />
    <meta property="og:url" content="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/" />
    <meta property="og:description" content="Make your Drupal sites faster" />
    <meta property="fb:app_id" content="410615979137383" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    
        <meta property="og:image" content="http://www.pixelite.co.nz/img/post-bg-02.jpg" />
    

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@pixelite_">
    
        <meta name="twitter:creator" content="@wiifm">
    
    <meta name="twitter:title" content="Using EntityCache to speed up your Drupal site">
    <meta name="twitter:description" content="Make your Drupal sites faster">
    
        <meta name="twitter:image" content="http://www.pixelite.co.nz/img/post-bg-02.jpg">
    


    <title>Using EntityCache to speed up your Drupal site - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    
<!-- Main Content -->
<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="704"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/"/>

    <header class="intro-header" style="background-image: url('/img/post-bg-02.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1 itemprop="name headline">Using EntityCache to speed up your Drupal site</h1>
                    
                    <h2 class="subheading" itemprop="description">Make your Drupal sites faster</h2>
                    

                    <span class="meta">Posted by <a href="/authors/sean-hamlin/" title="View Sean Hamlin's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span></a> on <time datetime="2013-04-01T00:00:00" itemprop="datePublished">April 1, 2013</time></span>
                    <ul class="social-buttons cf">
                        <li>
                            <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Using EntityCache to speed up your Drupal site" data-url="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                        </li>
                        <li>
                            <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                        </li>
                        <li>
                            <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/&amp;t=Using%20EntityCache%20to%20speed%20up%20your%20Drupal%20site" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                        </li>
                        <li>
                            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/&amp;title=Using%20EntityCache%20to%20speed%20up%20your%20Drupal%20site" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site/" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>As you are aware Drupal likes to query the database, a lot. On complex pages it is not uncommon to have over 1,000 database queries occur. With the introduction of fields into Drupal 7, now in order to fully load a node, Drupal now also needs to join across many tables. Quickly you can see there being a scalability issue here.</p>
<p>Luckily with Drupal 7, there is a pluggable caching and entity loading system. This means you can replace Drupal's default entity loading mechanism with another. Out of the box, <a href="http://drupal.org/project/entitycache">entitycache</a> replaces the caching mechanism for core entities:</p>
<ul><li>comment</li><li>file</li><li>node</li><li>taxonomy_term</li><li>taxonomy_vocabulary</li><li>user</li></ul>
<h2>Under the hood</h2>
<p>What entitycache is doing behind the scenes is writting the completely loaded entities to a caching table (cache_entity_[entity-type]). The selects from these tables is inherantly faster than stock Drupal's joining across many tables.</p>
<h2>Real life example page speed</h2>
<p>On a complex site I am building now, one of the nodes, has another 12 nodes listed on there (this is currently done with EntityFieldQuery, but it could just as easily been views). Here are some metrics:</p>
<p><strong>No entitycache, page loadedâ€‹ first thing after a clear cache</strong></p>
<pre class="true; codetag prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="typ">Executed</span><span class="pln"> </span><span class="lit">1590</span><span class="pln"> queries </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">1897.61</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Queries</span><span class="pln"> exceeding </span><span class="lit">5</span><span class="pln"> ms are highlighted</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> execution time was </span><span class="lit">6728.64</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Memory</span><span class="pln"> used at</span><span class="pun">:</span><span class="pln"> devel_boot</span><span class="pun">()=</span><span class="lit">8.95</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> devel_shutdown</span><span class="pun">()=</span><span class="lit">144.97</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> PHP peak</span><span class="pun">=</span><span class="lit">146.5</span><span class="pln"> MB</span><span class="pun">.</span></li></ol></pre>
<p><strong>No entitycache, cache primed</strong></p>
<pre class="true; codetag prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="typ">Executed</span><span class="pln"> </span><span class="lit">508</span><span class="pln"> queries </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">628.06</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Queries</span><span class="pln"> exceeding </span><span class="lit">5</span><span class="pln"> ms are highlighted</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> execution time was </span><span class="lit">1799.17</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Memory</span><span class="pln"> used at</span><span class="pun">:</span><span class="pln"> devel_boot</span><span class="pun">()=</span><span class="lit">9.31</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> devel_shutdown</span><span class="pun">()=</span><span class="lit">89.94</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> PHP peak</span><span class="pun">=</span><span class="lit">90.75</span><span class="pln"> MB</span><span class="pun">.</span></li></ol></pre>
<p>Now we add entitycache.</p>
<p><strong>With entitycache, page loaded first thing after a clear cache</strong></p>
<pre class="true; codetag prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="typ">Executed</span><span class="pln"> </span><span class="lit">1624</span><span class="pln"> queries </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">1964.65</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Queries</span><span class="pln"> exceeding </span><span class="lit">5</span><span class="pln"> ms are highlighted</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> execution time was </span><span class="lit">6768.48</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Memory</span><span class="pln"> used at</span><span class="pun">:</span><span class="pln"> devel_boot</span><span class="pun">()=</span><span class="lit">8.95</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> devel_shutdown</span><span class="pun">()=</span><span class="lit">145.17</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> PHP peak</span><span class="pun">=</span><span class="lit">146.75</span><span class="pln"> MB</span><span class="pun">.</span></li></ol></pre>
<p><strong>With entitycache, cache primed</strong></p>
<pre class="true; codetag prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="typ">Executed</span><span class="pln"> </span><span class="lit">396</span><span class="pln"> queries </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">564.3</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Queries</span><span class="pln"> exceeding </span><span class="lit">5</span><span class="pln"> ms are highlighted</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> execution time was </span><span class="lit">1680.65</span><span class="pln"> ms</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Memory</span><span class="pln"> used at</span><span class="pun">:</span><span class="pln"> devel_boot</span><span class="pun">()=</span><span class="lit">7.96</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> devel_shutdown</span><span class="pun">()=</span><span class="lit">89.57</span><span class="pln"> MB</span><span class="pun">,</span><span class="pln"> PHP peak</span><span class="pun">=</span><span class="lit">90.5</span><span class="pln"> MB</span><span class="pun">.</span></li></ol></pre>
<p>As you can see entitycache adds an initial overhead in order to populate the cache tables, but once this is done, all subsequent entity loads are much faster, and there is less database traffic overall (22% less SQL queries).</p>
<h2>Real life entity loading speed</h2>
<p>To load 12 nodes using entitycache (this query was taken from the above page generation):</p>
<pre class="true; codetag prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="pln">SELECT cid</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">,</span><span class="pln"> created</span><span class="pun">,</span><span class="pln"> expire</span><span class="pun">,</span><span class="pln"> serialized FROM cache_entity_node WHERE cid IN </span><span class="pun">(</span><span class="str">'4370'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'122'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2828'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'120'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3648'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3045'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4356'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3642'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3379'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3067'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'107'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4376'</span><span class="pun">)</span></li></ol></pre>
<p>Takes 18.34ms.</p>
<h2>How to install entitycache</h2>
<p>Simple with drush, I run the development build as it contains a number of new features and fixes.</p>
<pre class="true; codetag prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="pln">drush dl entitycache</span><span class="pun">-</span><span class="lit">7.x</span><span class="pun">-</span><span class="lit">1.x</span><span class="pun">-</span><span class="pln">dev</span></li><li class="L1"><span class="pln">drush en entitycache </span><span class="pun">-</span><span class="pln">y</span></li></ol></pre>
<p>If you have any success stories, let me know in the comments.</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    
                        var disqus_url = 'http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site';
                    

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/convert-existing-textfield-textarea-drupal-7/" data-toggle="tooltip" data-placement="top" title="Convert an existing textfield into a textarea in Drupal 7">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/how-exclude-casperjs-your-google-analytics-statistics/" data-toggle="tooltip" data-placement="top" title="How to exclude CasperJS from your Google Analytics statistics">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>



    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2016 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
