<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <meta name="description" content="It has long been a pain point of mine to see pieces of code like this sprinkled over the code base:$showid = $node-&gt;field_seriesid[LANGUAGE_NONE][0]['value']Not only does this hard code the language into the field value lookup, it also throws PHP warnings when the field has    no data (due to the array keys not being set).One of the projects we are currently working on is fully    multilingual, using a combination of i18n (translation using separate    nodes for each translation) and entity_translation    (translation using one node, with field translation). It became apparent that a better solution was required here.Entity metadata wrappers to the rescueThis wrapping class is provided by the Entity API module, which I would highly recommend you run (more    than likely you already are as it is required by some other modules).How to use the API// use entity metadata wrappers as they are SMART$wrapper = entity_metadata_wrapper('node', $node);dsm($wrapper-&gt;getPropertyInfo());This will print out a list of all known fields on the node, and you can access properties easily. Once you have the    $wrapper object defined you will now be able to use the below advanced syntax for quering values of fields.    Retrieving an integer value of a fieldTo retrieve the raw value from a field you can use the raw() accessor    method, this will perform no additional logic other than returning the current value. It is useful for integer    fields etc.Old approach$showid = $node-&gt;field_seriesid[LANGUAGE_NONE][0]['value'];Entity metadata wrapper approach$showid = $wrapper-&gt;field_seriesid-&gt;raw();Retrieving taxonomy term name in a single-select taxonomyTo load entities nested within entities you can use    the value() accessor method. This comes in very handy for taxonomy terms, users, files etc.Old    approach// Extract Te Reo level$level = $show-&gt;field_te_reo_level;$tid = $level[LANGUAGE_NONE][0]['tid'];$term = taxonomy_term_load($tid);$variables['level'] = $term-&gt;name;Entity metadata wrapper approach$variables['level'] = $wrapper-&gt;field_te_reo_level-&gt;value()-&gt;name;Retrieving taxonomy term names in a multi-select taxonomyWhat if we needed to loop around a unlimited    multi-select list of terms. The code is simple to adapt from above.Old approach// add the items from the 'show_features' taxonomy$show_features = array();$features = $series-&gt;field_features;if (is_array($features[LANGUAGE_NONE])) {&nbsp; foreach($features[LANGUAGE_NONE] as $tids) {&nbsp;&nbsp;&nbsp; $tid = $tids['tid'];&nbsp;&nbsp;&nbsp; $term = taxonomy_term_load($tid);&nbsp;&nbsp;&nbsp; $featureList[] = $term-&gt;name;&nbsp; }}Entity metadata wrapper approach// add the items from the 'show_features' taxonomy$show_features = array();foreach ($show_wrapper-&gt;field_features-&gt;value() as $index =&gt; $feature) {&nbsp; $show_features[] = $feature-&gt;name;}In this example you really see a glimpse of the power of entity metadata wrappers, here they have automatically    loaded the taxonomy term entities that were contained inside the main $node entity, and now we can loop directly    around the loaded terms. This saves a lot of code and makes it more readable.Language specific fieldsEntity metadata wrappers have native support for accessing the value of language specific fields (e.g. when using    field translations),Entity metadata wrapper approachglobal $language;// get the localised title and body (hence the language param)$title = $wrapper-&gt;language($language-&gt;language)-&gt;title_field-&gt;raw();$body = $wrapper-&gt;language($language-&gt;language)-&gt;body-&gt;value-&gt;value(array('sanitize' =&gt; TRUE));Why use entity metadata wrappers?    Makes your code more readable    Provides a standardised way of accessing field values and entities through an API    Stopped you hard coding the language key into the array lookups    Stops those nasty PHP warnings when you are trying to access properties that do not exist    The wrapper autoloads entities (when used in conjunction with the -&gt;value() accessor), which allowing you to        chain the callbacks    Further readingI would reccommend watching fago's    Drupalcon Denver talk on entities as it contains a lot of information on this topic.Your thoughtsHow have you found entity metadata wrappers? Leave a comment if you have found this article helpful or you have some    other useful advice.">
    


    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#603cba">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- OpenGraph Tags -->
    <meta property="og:title" content="How to use Entity Metadata Wrappers with Drupal 7" />
    <meta property="og:site_name" content="Pixelite" />
    <meta property="og:url" content="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7" />
    <meta property="og:description" content="" />
    <meta property="fb:app_id" content="410615979137383" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />

    
        <meta property="og:image" content="http://www.pixelite.co.nz/img/post-bg-02.jpg" />
    

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@pixelite_">
    
        <meta name="twitter:creator" content="@wiifm">
    
    <meta name="twitter:title" content="How to use Entity Metadata Wrappers with Drupal 7">
    <meta name="twitter:description" content="">
    
        <meta name="twitter:image" content="http://www.pixelite.co.nz/img/post-bg-02.jpg">
    


    <title>How to use Entity Metadata Wrappers with Drupal 7 - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    

<article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="766"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7"/>

    <!-- Post Header -->
    <header class="intro-header" style="background-image: url('/img/post-bg-02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 itemprop="name headline">How to use Entity Metadata Wrappers with Drupal 7</h1>
                        

                        <span class="meta">Posted by <a href="/authors/sean-hamlin/" title="View Sean Hamlin's profile"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span></a> on <time datetime="2012-09-15T00:00:00" itemprop="datePublished">September 15, 2012</time></span>
                        <ul class="social-buttons cf">
                            <li>
                                <a href="http://twitter.com/share" class="socialite twitter-share" data-text="How to use Entity Metadata Wrappers with Drupal 7" data-url="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                            </li>
                            <li>
                                <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7&amp;t=How%20to%20use%20Entity%20Metadata%20Wrappers%20with%20Drupal%207" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                            </li>
                            <li>
                                <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7&amp;title=How%20to%20use%20Entity%20Metadata%20Wrappers%20with%20Drupal%207" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>It has long been a pain point of mine to see pieces of code like this sprinkled over the code base:</p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">$showid = $node-&gt;field_seriesid[LANGUAGE_NONE][0]['value']</pre>
<p>Not only does this hard code the language into the field value lookup, it also throws PHP warnings when the field has
    no data (due to the array keys not being set).</p><p>One of the projects we are currently working on is fully
    multilingual, using a combination of <a href="https://drupal.org/project/i18n">i18n</a> (translation using separate
    nodes for each translation) and <a href="https://drupal.org/project/entity_translation">entity_translation</a>
    (translation using one node, with field translation). It became apparent that a better solution was required here.
</p><h2>Entity metadata wrappers to the rescue</h2><p>This wrapping class is provided by the <a
        href="https://drupal.org/project/entity">Entity API</a> module, which I would highly recommend you run (more
    than likely you already are as it is required by some other modules).</p><h2>How to use the API</h2>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">// use entity metadata wrappers as they are SMART
$wrapper = entity_metadata_wrapper('node', $node);
dsm($wrapper-&gt;getPropertyInfo());</pre>
<p>This will print out a list of all known fields on the node, and you can access properties easily. Once you have the
    $wrapper object defined you will now be able to use the below advanced syntax for quering values of fields.</p><h3>
    Retrieving an integer value of a field</h3><p>To retrieve the raw value from a field you can use the raw() accessor
    method, this will perform no additional logic other than returning the current value. It is useful for integer
    fields etc.</p><p><strong>Old approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">$showid = $node-&gt;field_seriesid[LANGUAGE_NONE][0]['value'];</pre>
<p><strong>Entity metadata wrapper approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">$showid = $wrapper-&gt;field_seriesid-&gt;raw();</pre>
<h3>Retrieving taxonomy term name in a single-select taxonomy</h3><p>To load entities nested within entities you can use
    the value() accessor method. This comes in very handy for taxonomy terms, users, files etc.</p><p><strong>Old
    approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">// Extract Te Reo level
$level = $show-&gt;field_te_reo_level;
$tid = $level[LANGUAGE_NONE][0]['tid'];
$term = taxonomy_term_load($tid);
$variables['level'] = $term-&gt;name;</pre>
<p><strong>Entity metadata wrapper approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">$variables['level'] = $wrapper-&gt;field_te_reo_level-&gt;value()-&gt;name;</pre>
<h3>Retrieving taxonomy term names in a multi-select taxonomy</h3><p>What if we needed to loop around a unlimited
    multi-select list of terms. The code is simple to adapt from above.</p><p><strong>Old approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">// add the items from the 'show_features' taxonomy
$show_features = array();
$features = $series-&gt;field_features;
if (is_array($features[LANGUAGE_NONE])) {
&nbsp; foreach($features[LANGUAGE_NONE] as $tids) {
&nbsp;&nbsp;&nbsp; $tid = $tids['tid'];
&nbsp;&nbsp;&nbsp; $term = taxonomy_term_load($tid);
&nbsp;&nbsp;&nbsp; $featureList[] = $term-&gt;name;
&nbsp; }
}</pre>
<p><strong>Entity metadata wrapper approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">// add the items from the 'show_features' taxonomy
$show_features = array();
foreach ($show_wrapper-&gt;field_features-&gt;value() as $index =&gt; $feature) {
&nbsp; $show_features[] = $feature-&gt;name;
}</pre>
<p>In this example you really see a glimpse of the power of entity metadata wrappers, here they have automatically
    loaded the taxonomy term entities that were contained inside the main $node entity, and now we can loop directly
    around the loaded terms. This saves a lot of code and makes it more readable.</p><h3>Language specific fields</h3>
<p>Entity metadata wrappers have native support for accessing the value of language specific fields (e.g. when using
    field translations),</p><p><strong>Entity metadata wrapper approach</strong></p>
<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">global $language;
// get the localised title and body (hence the language param)
$title = $wrapper-&gt;language($language-&gt;language)-&gt;title_field-&gt;raw();
$body = $wrapper-&gt;language($language-&gt;language)-&gt;body-&gt;value-&gt;value(array('sanitize' =&gt; TRUE));</pre>
<h2>Why use entity metadata wrappers?</h2>
<ul>
    <li>Makes your code more readable</li>
    <li>Provides a standardised way of accessing field values and entities through an API</li>
    <li>Stopped you hard coding the language key into the array lookups</li>
    <li>Stops those nasty PHP warnings when you are trying to access properties that do not exist</li>
    <li>The wrapper autoloads entities (when used in conjunction with the -&gt;value() accessor), which allowing you to
        chain the callbacks
    </li>
</ul><h2>Further reading</h2><p>I would reccommend watching <a href="http://wolfgangziegler.net/drupalcon-denver">fago's
    Drupalcon Denver talk</a> on entities as it contains a lot of information on this topic.</p><h3>Your thoughts</h3>
<p>How have you found entity metadata wrappers? Leave a comment if you have found this article helpful or you have some
    other useful advice.</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/how-use-entity-metadata-wrappers-drupal-7';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/using-git-attributes-exclude-files-your-release" data-toggle="tooltip" data-placement="top" title="Using git attributes to exclude files from your release">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/remote-debugging-chrome-and-android" data-toggle="tooltip" data-placement="top" title="Remote debugging with Chrome and Android">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
