<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="For a recent project I was tasked with migrating the old Twitter 1.0 API widget to the new Twitter embedded timeline functionality.">
    

    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Convert an existing textfield into a textarea in Drupal 7 - Pixelite</title>

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="All posts" href="http://www.pixelite.co.nz/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="All Drupal planet posts" href="http://www.pixelite.co.nz/drupalplanet.xml" />

    <link rel="canonical" href="http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-pixelite" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Pixelite homepage" src="/img/pixelite.svg" width="180" height="60" /></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about.html">About</a>
                </li>
                <li>
                    <a href="/contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <article itemscope="" itemtype="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-GB"/>
    <meta itemprop="wordCount" content="547"/>
    <meta itemprop="url" content="http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7"/>

    <!-- Post Header -->
    <header class="intro-header" style="background-image: url('/img/post-bg-02.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 itemprop="name headline">Convert an existing textfield into a textarea in Drupal 7</h1>
                        
                        <h2 class="subheading" itemprop="description">SQL to the rescue</h2>
                        
                        <span class="meta">Posted by <span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Sean Hamlin</span></span> on <time datetime="2013-03-07T00:00:00" itemprop="datePublished">March 7, 2013</time></span>
                        <ul class="social-buttons cf">
                            <li>
                                <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Convert an existing textfield into a textarea in Drupal 7" data-url="http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">Share on Twitter</span></a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/share?url=http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7" class="socialite googleplus-one" data-size="tall" data-href="http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7" rel="nofollow" target="_blank"><span class="vhidden">Share on Google+</span></a>
                            </li>
                            <li>
                                <a href="http://www.facebook.com/sharer.php?u=http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7&amp;t=Convert%20an%20existing%20textfield%20into%20a%20textarea%20in%20Drupal%207" class="socialite facebook-like" data-href="http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">Share on Facebook</span></a>
                            </li>
                            <li>
                                <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7&amp;title=Convert%20an%20existing%20textfield%20into%20a%20textarea%20in%20Drupal%207" class="socialite linkedin-share" data-url="http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7" data-counter="top" rel="nofollow" target="_blank"><span class="vhidden">Share on LinkedIn</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <div itemprop="articleBody">
                    <p>For a recent project I was tasked with migrating the old Twitter 1.0 API widget to the new <a href="https://dev.twitter.com/docs/embedded-timelines">Twitter embedded timeline</a> functionality.</p>

<p>The original field was a simple 255 character textfield:</p>

<p><img src="/img/textarea/twitter_username.png" width="574" height="98" alt="Original textfield showing the single line field and it's original purpose" class="img-responsive img-thumbnail" /></p>

<p>This obviously would not hold the multi-line, roughly 500 character content of the new Twitter embedded timeline. So a change was required in order to extent the size of this field.</p>

<p>It is true, that you can simply delete the field, and then create a new one, with a new name. I chose instead to retain the existing field (and it’s content), this way content authors would know what content used to be in the old textfield prior to conversion.</p>

<h2 id="update-hook-to-the-rescue">Update hook to the rescue</h2>

<p>Update hooks in Drupal can be used to perform one time database manipulations. This makes them ideal for this type of change.</p>

<p>Here is the entire update hook that was written (the field name was <code>field_twitter_search</code>):</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Change Twitter into a textarea using fun SQL.</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">mts_show_update_7001</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Manual database changes.</span>
  <span class="nx">db_query</span><span class="p">(</span><span class="s2">&quot;UPDATE {field_config} SET type = &#39;text_long&#39; WHERE field_name = &#39;field_twitter_search&#39;&quot;</span><span class="p">);</span>
  <span class="nx">db_change_field</span><span class="p">(</span><span class="s1">&#39;field_data_field_twitter_search&#39;</span><span class="p">,</span> <span class="s1">&#39;field_twitter_search_value&#39;</span><span class="p">,</span> <span class="s1">&#39;field_twitter_search_value&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;varchar&#39;</span><span class="p">,</span>
    <span class="c1">// PostgreSQL allows up to 10,000,000 (1 GB), MySQL allows up to 21844.</span>
    <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20000&#39;</span><span class="p">,</span>
  <span class="p">));</span>
  <span class="nx">db_change_field</span><span class="p">(</span><span class="s1">&#39;field_revision_field_twitter_search&#39;</span><span class="p">,</span> <span class="s1">&#39;field_twitter_search_value&#39;</span><span class="p">,</span> <span class="s1">&#39;field_twitter_search_value&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;varchar&#39;</span><span class="p">,</span>
    <span class="c1">// PostgreSQL allows up to 10,000,000 (1 GB), MySQL allows up to 21844.</span>
    <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20000&#39;</span><span class="p">,</span>
  <span class="p">));</span>

  <span class="c1">// Clear caches.</span>
  <span class="nx">field_cache_clear</span><span class="p">(</span><span class="k">TRUE</span><span class="p">);</span>

  <span class="c1">// Apply the new field instance configuration.</span>
  <span class="nx">features_revert</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;mts_show&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">),</span>
  <span class="p">));</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>To walk through this update hook, one step at a time:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nx">db_query</span><span class="p">(</span><span class="s2">&quot;UPDATE {field_config} SET type = &#39;text_long&#39; WHERE field_name = &#39;field_twitter_search&#39;&quot;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>This alters the field configuration and changes the type to be a textarea (changed from a textfield).</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nx">db_change_field</span><span class="p">(</span><span class="s1">&#39;field_data_field_twitter_search&#39;</span><span class="p">,</span> <span class="s1">&#39;field_twitter_search_value&#39;</span><span class="p">,</span> <span class="s1">&#39;field_twitter_search_value&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;varchar&#39;</span><span class="p">,</span>
  <span class="c1">// PostgreSQL allows up to 10,000,000 (1 GB), MySQL allows up to 21844.</span>
  <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20000&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>This (along with the next SQL query) alters the size of the data storage column in both the field data and field revision tables. Be careful to choose a size that is allowed by your database.</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nx">field_cache_clear</span><span class="p">(</span><span class="k">TRUE</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>This clears Drupal’s internal cache for the fields</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nx">features_revert</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
  <span class="s1">&#39;mts_show&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">),</span>
<span class="p">));</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p>Finally, you can revert your feature on top. This requires you to have exported the content type (and it’s fields) with features. This allows you to for instance change the title and description of the field.</p>

<p>Here is a screenshot that shows the newly converted textarea, including new title and description</p>

<p><img src="/img/textarea/twitter_embed_code.png" width="1066" height="152" alt="The new textarea field showing a multi-line field with room for more content" class="img-responsive img-thumbnail" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>Drupal certainly does you no favours when it comes to field conversion with existing content already in those fields, luckily there still exist ways to get this done, in a cross database fashion.</p>

<p>Let me know if you have done similar conversions (rather than replacements), and how you went about that.</p>

                </div>

                <hr>

                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'pixelite'; // required: replace example with your forum shortname
                    var disqus_url = 'http://www.pixelite.co.nz/article/convert-existing-textfield-textarea-drupal-7';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/article/why-i-use-casperjs-regression-testing-web-applications" data-toggle="tooltip" data-placement="top" title="Why I use CasperJS for regression testing web applications">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://www.pixelite.co.nz/article/using-entitycache-speed-your-drupal-site" data-toggle="tooltip" data-placement="top" title="Using EntityCache to speed up your Drupal site">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>

</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">

        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/pixelite_">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/pixelite-co-nz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; Pixelite 2015 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- JS libs -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/js/socialite.min.js"></script>

<!-- Custom JS -->
<script src="/js/clean-blog.js"></script>

<!-- Social links -->
<script type="text/javascript">
    (function($) {
        Socialite.load();
    })(jQuery);
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34737960-1', 'auto');
    ga('send', 'pageview');
</script>


</body>

</html>
